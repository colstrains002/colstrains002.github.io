---
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { SITE_TITLE, SITE_DESCRIPTION } from "../consts";
import { getCollection } from "astro:content";

const dateFormatter = new Intl.DateTimeFormat("ja-JP", { dateStyle: "medium" });

const posts = (await getCollection("blog", ({ data }) => !data.draft)).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const latestPosts = posts.slice(0, 3);
---

<!doctype html>
<html lang="ja">
    <head>
        <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    </head>
    <body>
        <Header />
        <main>
            <h1>Colstrains</h1>

            <p>
                音楽・創作・日々のメモを書きます。<br />
                まずはブログ一覧からどうぞ。
            </p>

            <h2>最新記事</h2>
            <ul>
                {
                    latestPosts.map((post) => (
                        <li>
                            <a href={`/blog/${post.id}/`}>{post.data.title}</a>{" "}
                            <time datetime={post.data.pubDate.toISOString()}>
                                {dateFormatter.format(post.data.pubDate)}
                            </time>
                            {post.data.description ? (
                                <div>{post.data.description}</div>
                            ) : null}
                        </li>
                    ))
                }
            </ul>

            <p>
                <a href="/blog/">ブログ一覧へ</a>
                {" "}
                <a href="/about/">About</a>
            </p>
        </main>
        <Footer />
    </body>
</html>
